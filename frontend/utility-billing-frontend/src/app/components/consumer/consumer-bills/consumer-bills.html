<div class="bills-container">

    <h1 class="title">My Bills</h1>

    <!-- Utility -->
    <div class="tabs">
        <button *ngFor="let utility of utilities" (click)="filterBills(utility)"
            [class.active]="utility === activeUtility">
            {{ utility }}
        </button>
    </div>

    <p *ngIf="loading" class="loading">Loading bills...</p>

    <p *ngIf="errorMessage" class="error">{{ errorMessage }}</p>

    <!-- Bills Table -->
    <table *ngIf="!loading && filteredBills.length > 0">
        <thead>
            <tr>
                <th>Bill Date</th>
                <th>Due Date</th>
                <th>Units</th>
                <th>Total</th>
                <th>Remaining</th>
                <th>Status</th>
                <th>Action</th>
            </tr>
        </thead>

        <tbody>
            <tr *ngFor="let bill of filteredBills">
                <td>{{ bill.billDate }}</td>
                <td>{{ bill.dueDate | date:'yyyy-MM-dd' }}</td>
                <td>{{ bill.unitsConsumed }}</td>
                <td>₹ {{ bill.totalAmount }}</td>
                <td>
                    <strong>₹ {{ bill.outstandingAmount }}</strong>
                </td>
                <td>
                    <span class="status" [class.paid]="bill.status === 'PAID'" [class.due]="bill.status === 'DUE'"
                        [class.overdue]="bill.status === 'OVERDUE'">
                        {{ bill.status }}
                    </span>
                </td>
                <td>
                    <button class="pay-btn" *ngIf="bill.outstandingAmount > 0" (click)="selectBill(bill)">
                        Pay
                    </button>
                </td>
            </tr>
        </tbody>
    </table>


    <!-- Pay Bill Section -->
    <!-- Payment Modal Overlay -->
    <div class="modal-overlay" *ngIf="selectedBill">
        <div class="modal">

            <button class="close-btn" (click)="closeModal()">✕</button>

            <h3>Pay Bill</h3>

            <p><strong>Utility:</strong> {{ selectedBill.utilityType }}</p>
            <p><strong>Total Amount:</strong> ₹ {{ selectedBill.totalAmount }}</p>
            <p><strong>Outstanding:</strong> ₹ {{ selectedBill.outstandingAmount }}</p>

            <label>Pay Amount</label>
            <input type="number" [(ngModel)]="payment.amount" [max]="selectedBill.outstandingAmount" min="1" />

            <label>Payment Mode</label>
            <select [(ngModel)]="payment.paymentMode">
                <option *ngFor="let mode of paymentModes" [value]="mode">
                    {{ mode }}
                </option>
            </select>

            <button class="pay-now" (click)="makePayment()" [disabled]="paying">
                {{ paying ? 'Processing...' : 'Pay Now' }}
            </button>

            <p class="success" *ngIf="paymentMessage && !paying">
                {{ paymentMessage }}
            </p>

        </div>
    </div>


    <p *ngIf="!loading && filteredBills.length === 0" class="empty">
        No {{ activeUtility.toLowerCase() }} bills available
    </p>

</div>