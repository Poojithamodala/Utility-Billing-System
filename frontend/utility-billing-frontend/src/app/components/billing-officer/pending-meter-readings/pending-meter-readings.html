<div class="page">

  <h2>Meter Readings</h2>

  <!-- Utility Tabs -->
  <div class="tabs">
    <button *ngFor="let u of utilities" (click)="filterByUtility(u)" [class.active]="u === activeUtility">
      {{ u }}
    </button>
  </div>

  <p *ngIf="loading">Loading pending readings...</p>
  <p *ngIf="error" class="error">{{ error }}</p>

  <table *ngIf="!loading && filteredPending.length">
    <thead>
      <tr>
        <th>Consumer</th>
        <th>Meter No</th>
        <th>Last Reading</th>
        <th>Last Date</th>
        <th>Current Reading</th>
        <th>Action</th>
      </tr>
    </thead>

    <tbody>
      <tr *ngFor="let r of filteredPending">
        <td>{{ r.consumerEmail }}</td>
        <td>{{ r.meterNumber }}</td>
        <td>{{ r.lastReadingValue }}</td>
        <td>{{ r.lastReadingDate || 'â€”' }}</td>

        <td>
          <input type="number" [(ngModel)]="r.currentReading" [disabled]="r.readingSaved" />
        </td>

        <td>
          <!-- Save Reading -->
          <button *ngIf="!r.readingSaved" (click)="submitReading(r)">
            Save Reading
          </button>

          <!-- Generate Bill -->
          <button *ngIf="r.readingSaved" class="bill-btn" (click)="generateBill(r)">
            Generate Bill
          </button>
        </td>
      </tr>
    </tbody>
  </table>
  <div class="simple-popup-overlay" *ngIf="popupVisible">
    <div class="simple-popup">
      <p>{{ popupMessage }}</p>
      <button (click)="closePopup()">OK</button>
    </div>
  </div>

  <p *ngIf="!loading && filteredPending.length === 0">
    No pending {{ activeUtility.toLowerCase() }} readings
  </p>

</div>